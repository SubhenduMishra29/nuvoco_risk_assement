<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>Risk Management Dashboard</title>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <style>
      body{font-family:Arial,Helvetica,sans-serif; padding:16px;}
      table{width:100%; border-collapse:collapse;}
      th, td{padding:8px; border:1px solid #ddd;}
      .open{background:#ffd6d6;}
      .approved{background:#fff3cd;}
      .closed{background:#d4f7d6;}
    </style>
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  </head>
  <body>
    <h1>Jobs Dashboard</h1>
    <table id="jobsTable">
      <thead>
        <tr><th>Title</th><th>Worker</th><th>Manager</th><th>Status</th><th>Created At</th><th>Validity</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      // Paste your Firebase config here
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        // ... etc ...
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      function formatTS(ts) {
        if (!ts) return '';
        try {
          const d = ts.toDate ? ts.toDate() : new Date(ts.seconds * 1000);
          return d.toLocaleString();
        } catch(e) { return ''; }
      }

      db.collection('jobs').orderBy('createdAt','desc')
        .onSnapshot(snapshot => {
          const tbody = document.querySelector('#jobsTable tbody');
          tbody.innerHTML = '';
          snapshot.forEach(doc => {
            const d = doc.data();
            const tr = document.createElement('tr');
            const status = (d.status || 'open');
            tr.className = status;
            tr.innerHTML = `
              <td>${d.title || ''}</td>
              <td>${(d.createdBy && d.createdBy.name) || ''}</td>
              <td>${(d.assignedTo && d.assignedTo.name) || ''}</td>
              <td>${status}</td>
              <td>${formatTS(d.createdAt)}</td>
              <td>${formatTS(d.validity)}</td>
            `;
            tbody.appendChild(tr);
          });
        });
    </script>
  </body>
</html>
